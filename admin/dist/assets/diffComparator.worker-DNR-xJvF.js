(function(){"use strict";importScripts("../jslib/xxhash.min.js"),self.addEventListener("message",function(f){const r=f.data[0],g=f.data[1];console.log(r),console.log(g),new u(r,g).compareScreenshots()});function u(f,r){this.image1=f,this.image2=r,this.compareScreenshots=function(){this.compareLCS(this.image1,this.image2)},this.compareLCS=function(t,e){const o=this.getHash(t),n=this.getHash(e);console.log(o),console.log(n);const s=this.getComparisonResult(o,n);console.log("Added => "),console.log(s[0]),console.log("modified => "),console.log(s[1]),console.log("deleted => "),console.log(s[2]),self.postMessage(s)},this.getHash=function(t){const e=[];for(let o=0;o<t.height;o++){let n="";for(let s=0;s<t.width*4;s+=4){const c=s+o*t.width*4,h=g(t.src[c],t.src[c+1],t.src[c+2],t.src[c+3]);n+=h}e.push(XXH.h32(n,32).toNumber())}return e};function g(t,e,o,n){return t=t.toString(16),e=e.toString(16),o=o.toString(16),n=n.toString(16),t.length===1&&(t="0"+t),e.length===1&&(e="0"+e),o.length===1&&(o="0"+o),n.length===1&&(n="0"+n),"#"+t+e+o+n}this.getComparisonResult=function(t,e){const o=[],n=[],s=[],c=[];let h=0;for(let i=0;i<t.length;i++)t[i]===e[i]&&(h<i-1&&o.push([h+1,i-1]),h=i);return h===0&&o.push([0,t.length-1]),o.forEach(i=>{const p=d(e,t.slice(i[0],i[1]));if(p!==-1)for(let l=0;l<i[1]+1-i[0];l++)c.push({beforeIndex:i[0]+l,afterIndex:p+l});else for(let l=0;l<i[1]+1-i[0];l++)s.push(i[0]+l),n.push(i[0]+l)}),[n,s,c]};function d(t,e){if(t.length===0||e.length===0||e.length>t.length)return-1;for(let o=0;o<t.length;o++)if(t[o]===e[0]){let n=!0;for(let s=0;s<e.length;s++)if(t.length<=o+s||e[s]!==t[o+s]){n=!1;break}if(n)return o}return-1}}})();
