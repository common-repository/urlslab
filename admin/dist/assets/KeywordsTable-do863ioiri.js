import{w as T,r as u,R as t,_ as l,x as M,E as d,N as S,y as D,z as L,V as c,aR as R,I as k,aW as F,W as O,ai as P,O as A,Q as K,U as B,aO as x,A as W,L as q,X as $,M as H,C as Q,Y as X,aX as Y,S as j,f as G,i as J,g as Z}from"../main-do863ioiri.js";const ee=l("Add New Link","urlslab"),I="kw_id",g="keyword",b={keyword:l("Keyword","urlslab"),urlLink:l("Link","urlslab"),lang:l("Language","urlslab"),kw_priority:l("Priority","urlslab"),urlFilter:l("URL filter","urlslab"),kw_length:l("Length","urlslab"),kwType:l("Type","urlslab"),kw_usage_count:l("Usage","urlslab"),valid_until:l("Valid until","urlslab"),labels:l("Tags","urlslab")},te={columnVisibility:{kw_length:!1,kwType:!1,valid_until:!1}};function se({slug:r}){const a=T(o=>o.setTable),[s,p]=u.useState(!1);return u.useEffect(()=>{p(!0),a(r,{title:ee,paginationId:I,slug:r,header:b,id:g})},[a,r]),s&&t.createElement(ae,{slug:r})}function ae({slug:r}){const{data:a,columnHelper:s,isLoading:p,isSuccess:o,isFetchingNextPage:h,ref:y}=M({slug:r}),n=u.useMemo(()=>{var e;return(e=a==null?void 0:a.pages)==null?void 0:e.flatMap(i=>i??[])},[a==null?void 0:a.pages]),f=T(e=>e.setTable),v=d(e=>e.activatePanel),V=d(e=>e.setRowToEdit),E=d(e=>e.setOptions),{columnTypes:w,isLoadingColumnTypes:U}=S(r),{updateRow:m,deleteRow:C}=D(),_=u.useCallback(e=>{const i=e==null?void 0:e.row.original,z=e==null?void 0:e.getValue();E([]),V({}),m({cell:e,id:g}),i.kw_usage_count>0&&E([{detailsOptions:{title:l("Keyword %s usage","urlslab").replace("%s",`“${i.keyword}”`),text:l("Keyword %s used on these URLs","urlslab").replace("%s",`“${i.keyword}”`),slug:r,url:`${i.kw_id}/${i.dest_url_id}`,showKeys:[{name:["link_type",l("Type","urlslab")],size:30,values:{U:l("Urlslab","urlslab"),E:l("Editor","urlslab")}},{name:["url_name",l("URL","urlslab")]}],listId:"url_id",counter:z}}])},[E,V,r,m]),N=u.useMemo(()=>w?[s.accessor("check",{className:"checkbox",cell:e=>t.createElement(L,{tableElement:e}),header:e=>t.createElement(L,{tableElement:e})}),s.accessor("keyword",{tooltip:e=>e.getValue(),cell:e=>t.createElement("strong",null,e.getValue()),header:e=>t.createElement(c,{...e}),minSize:200}),s.accessor("urlLink",{tooltip:e=>e.getValue(),cell:e=>t.createElement("a",{href:e.getValue(),title:e.getValue(),target:"_blank",rel:"noreferrer"},e.getValue()),header:e=>t.createElement(c,{...e}),size:200}),s.accessor("lang",{className:"nolimit",cell:e=>t.createElement(R,{defaultValue:e==null?void 0:e.getValue(),listboxStyles:{minWidth:300},onChange:i=>m({newVal:i,cell:e,id:g})}),header:e=>t.createElement(c,{...e}),size:100}),s.accessor("kw_priority",{className:"nolimit",cell:e=>t.createElement(k,{type:"number",max:100,value:e.getValue(),onChange:i=>m({newVal:i,cell:e,id:g})}),header:e=>t.createElement(c,{...e}),size:80}),s.accessor("urlFilter",{className:"nolimit",cell:e=>t.createElement(k,{value:e.getValue(),onChange:i=>m({newVal:i,cell:e,id:g})}),header:e=>t.createElement(c,{...e}),size:150}),s.accessor("valid_until",{className:"nolimit",cell:e=>{const i=e.getValue();return i&&F(i)?t.createElement(O,{datetime:i,noTime:!0}):""},header:e=>t.createElement(c,{...e}),size:30}),s.accessor("kw_length",{header:e=>t.createElement(c,{...e}),size:80}),s.accessor("kwType",{className:"nolimit",cell:e=>w==null?void 0:w.kwType.values[e.getValue()],header:e=>t.createElement(c,{...e}),size:80}),s.accessor("kw_usage_count",{cell:e=>t.createElement(P,{direction:"row",alignItems:"center",spacing:1},t.createElement(t.Fragment,null,t.createElement("span",null,e==null?void 0:e.getValue()),(e==null?void 0:e.getValue())>0&&t.createElement(A,{title:l("Show URLs where used","urlslab"),arrow:!0,placement:"bottom"},t.createElement(K,{size:"xs",onClick:()=>{_(e),v(0)}},t.createElement(B,{name:"link"}))))),header:e=>t.createElement(c,{...e}),size:80}),s.accessor("labels",{className:"nolimit",cell:e=>t.createElement(x,{value:e.getValue(),slug:r,onChange:i=>m({newVal:i,cell:e,id:g})}),header:b.labels,size:150}),s.accessor("editRow",{className:"editRow",cell:e=>t.createElement(W,{onEdit:()=>_(e),onDelete:()=>C({cell:e,id:g})}),header:null,size:0})]:[],[w,s,m,_,v,r,C]);return u.useEffect(()=>{f(r,{data:a})},[a,f,r]),p||U?t.createElement(q,{isFullscreen:!0}):t.createElement(t.Fragment,null,t.createElement($,{title:l("About this table","urlslab"),tableSlug:r,isMainTableDescription:!0},l("The table defines a list of keywords which can be automatically substituted with link pointing to defined URL in your website's text, facilitating large scale internal link building. This eliminates the need for manual editing of individual pages to add links. The plugin leaves all existing page content intact, with modifications only occurring as the page is generated. To reduce the strain on your Mysql database, the link definitions are cached on the server for a few minutes. Consequently, changes made to the link definitions may only be visibly updated online after a few minutes.","urlslab")),t.createElement(H,null),t.createElement(Q,{className:"fadeInto",initialState:te,columns:N,data:o&&n,referrer:y,loadingRows:h},t.createElement(X,null)),t.createElement(le,{slug:r}))}const le=u.memo(({slug:r})=>{const a=d(n=>n.rowToEdit),s=d(n=>n.setRowToEdit),p=d(n=>n.activePanel),{columnTypes:o}=S(r),h=u.useMemo(()=>({keyword:t.createElement(k,{liveUpdate:!0,autoFocus:!0,defaultValue:"",label:b.keyword,onChange:n=>{s({keyword:n})},required:!0,description:l("Only exact keyword matches will be substituted with a link","urlslab")}),urlLink:t.createElement(Y,{suggestInput:(a==null?void 0:a.keyword)||"",liveUpdate:!0,defaultValue:a!=null&&a.urlLink?a==null?void 0:a.urlLink:window.location.origin,label:b.urlLink,onChange:n=>s({urlLink:n}),required:!0,showInputAsSuggestion:!0,referenceVal:"keyword",description:l("Destination URL","urlslab")}),kwType:t.createElement(j,{defaultAccept:!0,hideOnAdd:!0,autoClose:!0,items:o==null?void 0:o.kwType.values,name:"kwType",defaultValue:"M",description:l("Select the link type if you only want to modify certain kinds of links in HTML","urlslab"),onChange:n=>s({kwType:n})},b.kwType),kw_priority:t.createElement(k,{liveUpdate:!0,type:"number",defaultValue:"10",min:"0",max:"100",label:b.kw_priority,description:l("Input a number between 0 and 100. Lower values indicate higher priority","urlslab"),onChange:n=>s({kw_priority:n})}),lang:t.createElement(R,{defaultValue:"",hasTitle:!0,description:l("Keywords only apply to pages in the chosen language","urlslab"),onChange:n=>s({lang:n})}),urlFilter:t.createElement(k,{liveUpdate:!0,defaultValue:".*",description:l("Optionally, you can permit keyword placement only on URLs that match a specific regular expression. Use value `.*` to match all URLs","urlslab"),label:b.urlFilter,onChange:n=>s({urlFilter:n})}),valid_until:t.createElement("label",{className:"urlslab-inputField-wrap"},t.createElement("span",{className:"urlslab-inputField-label flex flex-align-center mb-xs "},l("Valid until","urlslab")),t.createElement(G,{className:"urlslab-input",selected:a!=null&&a.valid_until&&F(a==null?void 0:a.valid_until)?new Date(a==null?void 0:a.valid_until):"",onChange:n=>{if(n){const{correctedDateFormatted:f}=J(n);s({valid_until:f});return}s({valid_until:""})},dateFormat:Z().date,calendarStartDay:window.wp.date.getSettings().l10n.startOfWeek,isClearable:!0})),labels:t.createElement(x,{optionItem:!0,label:l("Tags:","urlslab"),slug:r,onChange:n=>s({labels:n})})}),[o==null?void 0:o.kwType,a==null?void 0:a.keyword,a==null?void 0:a.urlLink,a==null?void 0:a.valid_until,s,r]),y=u.useMemo(()=>{const n={...h};return delete n.kwType,n},[h]);u.useEffect(()=>{d.setState(()=>({...d.getState(),rowEditorCells:p==="rowInserter"?y:h,deleteCSVCols:[I,"dest_url_id"]}))},[p,h,y])});export{se as default};
