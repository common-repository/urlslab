import{w as v,r as m,_ as l,R as t,x as z,E as h,y as F,z as R,V as d,W as y,ag as C,A as k,O as M,Q as x,U as A,L as N,X as D,M as B,C as q,Y as P,d as H,N as Q,s as T,at as O,n as V,S as I,I as X,aX as Y,aO as j}from"../main-do863ioiri.js";import{B as W}from"./BrowserIcon-do863ioiri.js";import{T as $}from"./TreeView-do863ioiri.js";import{h as E}from"./redirectsHeader-do863ioiri.js";const U="url_id",G=[{key:"updated",dir:"DESC",op:"<"}],J={url:l("URL","urlslab"),cnt:l("Visits","urlslab"),created:l("First visit","urlslab"),updated:l("Last visit","urlslab"),ip:l("IP address","urlslab"),country:l("Country","urlslab"),browser:l("User agent","urlslab"),referrer:l("Referrer","urlslab"),request:l("Request data","urlslab")},K={columnVisibility:{referrer:!1,request:!1}};function ce({slug:o}){const a=v(i=>i.setTable),[r,s]=m.useState(!1);return m.useEffect(()=>{s(!0),a(o,{title:l("Create redirect","urlslab"),paginationId:U,slug:o,header:J,id:"url",sorting:G})},[a,o]),r&&t.createElement(Z,{slug:o})}function Z({slug:o}){const{columnHelper:a,data:r,isLoading:s,isSuccess:i,isFetchingNextPage:p,ref:g}=z({slug:o}),c=m.useMemo(()=>{var e;return(e=r==null?void 0:r.pages)==null?void 0:e.flatMap(b=>b??[])},[r==null?void 0:r.pages]),u=v(e=>e.setTable),n=h(e=>e.setRowToEdit),S=h(e=>e.activatePanel),{deleteRow:_}=F(),w=m.useCallback(({cell:e})=>{const{url:b}=e.row.original;let f=new URL(window.location.href);try{f=new URL(b)}catch{}n({match_type:"E",redirect_code:"301",match_url:b,replace_url:f.protocol+f.hostname}),S("rowInserter")},[S,n]),L=m.useMemo(()=>[a.accessor("check",{className:"nolimit checkbox",cell:e=>t.createElement(R,{tableElement:e}),header:e=>t.createElement(R,{tableElement:e})}),a.accessor("url",{tooltip:e=>e.getValue(),header:e=>t.createElement(d,{...e}),minSize:200}),a.accessor("cnt",{header:e=>t.createElement(d,{...e}),minSize:50}),a.accessor("created",{cell:e=>t.createElement(y,{datetime:e.getValue()}),header:e=>t.createElement(d,{...e}),minSize:80}),a.accessor("updated",{cell:e=>t.createElement(y,{datetime:e.getValue()}),header:e=>t.createElement(d,{...e}),minSize:80}),a.accessor("referrer",{tooltip:e=>e.getValue(),header:e=>t.createElement(d,{...e}),minSize:100}),a.accessor("ip",{tooltip:e=>e.getValue(),header:e=>t.createElement(d,{...e}),minSize:100}),a.accessor("request",{className:"nolimit",cell:e=>t.createElement($,{sourceData:e.getValue(),isTableCellPopper:!0}),header:e=>t.createElement(d,{...e}),minSize:100}),a.accessor("country",{tooltip:e=>e.getValue(),cell:e=>t.createElement("strong",null,C[e.getValue()]?C[e.getValue()]:e.getValue()),header:e=>t.createElement(d,{...e}),minSize:40}),a.accessor("browser",{tooltip:e=>e.getValue(),header:e=>t.createElement(d,{...e}),cell:e=>t.createElement(W,{uaString:e.getValue()}),minSize:50}),a.accessor("editRow",{className:"editRow",cell:e=>t.createElement(k,{onDelete:()=>_({cell:e})},t.createElement(M,{title:l("Create redirect from 404","urlslab"),arrow:!0,placement:"bottom"},t.createElement(x,{size:"xs",onClick:()=>w({cell:e})},t.createElement(A,{name:"plus"})))),header:null,size:0})],[w,a,_]);return m.useEffect(()=>{u(o,{data:r})},[r,u,o]),s?t.createElement(N,{isFullscreen:!0}):t.createElement(t.Fragment,null,t.createElement(D,{title:l("About this table","urlslab"),tableSlug:o,isMainTableDescription:!0},l("This plugin stores all the URLs visited by your website users that resulted in a 404 error. Some of these URLs might be due to cyber-attacks attempting to decipher your web structure. However, some could be actual missing URLs that are included in your sitemap or website content. To address this issue, you have several options. You can create the missing page or use the Redirect Rule to guide the user to another appropriate page. The plugin also provides automatic redirect suggestions using AI technology.","urlslab")),t.createElement(B,{noImport:!0,noInsert:!0}),t.createElement(q,{className:"fadeInto",initialState:K,columns:L,data:i&&c,referrer:g,loadingRows:p,disableAddNewTableRecord:!0},t.createElement(P,null)),t.createElement(ee,{slug:o}))}const ee=m.memo(({slug:o})=>{const a=H(),r=h(c=>c.setRowToEdit),s=h(c=>c.rowToEdit),{columnTypes:i}=Q(o),p=m.useCallback(async()=>{const c="redirects";T(c,{message:l("Adding rowâ€¦","urlslab"),status:"info"});const u=await O("redirects/create",s,{skipErrorHandling:!0});if(u.ok)return T(c,{message:l("Row has been added.","urlslab"),status:"success"}),a.invalidateQueries([c],{refetchType:"all"}),!1;if(!u.ok&&u.status===409)return V(c,u,{message:l("Redirect for this URL probably exists.","urlslab")}),!1;V(c,u)},[a,s]),g=m.useMemo(()=>{var c,u;return{match_type:t.createElement(I,{autoClose:!0,items:(c=i==null?void 0:i.match_type)==null?void 0:c.values,name:"match_type",defaultValue:"E",onChange:n=>r({match_type:n})},E.match_type),match_url:t.createElement(X,{type:"url",liveUpdate:!0,defaultValue:s.match_url,label:E.match_url,onChange:n=>r({match_url:n})}),replace_url:t.createElement(Y,{suggestInput:(s==null?void 0:s.match_url)||"",autoFocus:!0,liveUpdate:!0,defaultValue:s!=null&&s.match_url?te(s==null?void 0:s.match_url):window.location.origin,label:E.replace_url,onChange:n=>r({replace_url:n}),required:!0,showInputAsSuggestion:!0,referenceVal:"match_url"}),redirect_code:t.createElement(I,{autoClose:!0,items:(u=i==null?void 0:i.redirect_code)==null?void 0:u.values,name:"redirect_code",defaultValue:"301",onChange:n=>r({redirect_code:n})},E.redirect_code),labels:t.createElement(j,{optionItem:!0,label:l("Tags:","urlslab"),slug:"redirects",onChange:n=>r({labels:n})})}},[i,s.match_url,r]);m.useEffect(()=>{h.setState(()=>({...h.getState(),rowEditorCells:g,deleteCSVCols:[U,"dest_url_id"]}))},[g]),m.useEffect(()=>{h.setState(()=>({...h.getState(),customSubmitAction:p}))},[p])}),te=o=>{try{const a=new URL(o);return a.protocol+"//"+a.hostname}catch{return o}};export{ce as default};
