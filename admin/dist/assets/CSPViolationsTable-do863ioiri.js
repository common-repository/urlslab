import{w as h,r as n,R as t,_ as i,x as k,y as R,s as b,at as x,z as E,V as p,W as P,A as y,B,L as D,X as F,M as I,C as N,Y as V}from"../main-do863ioiri.js";const z="blocked_url_id",T="violated_directive",A={violated_directive:i("Violated CSP Directive","urlslab"),blocked_url:i("Blocked URL/Domain","urlslab"),updated:i("Updated","urlslab")};function H({slug:s}){const o=h(u=>u.setTable),[a,d]=n.useState(!1);return n.useEffect(()=>{d(!0),o(s,{paginationId:z,slug:s,header:A,id:"url",optionalSelector:T})},[o,s]),a&&t.createElement(M,{slug:s})}function M({slug:s}){const{columnHelper:o,data:a,isLoading:d,isSuccess:u,isFetchingNextPage:_,ref:C}=k({slug:s}),v=n.useMemo(()=>{var e;return(e=a==null?void 0:a.pages)==null?void 0:e.flatMap(m=>m??[])},[a==null?void 0:a.pages]),f=h(e=>e.setTable),{deleteRow:g}=R(),S=n.useCallback(async e=>{const{violated_directive:m,blocked_url_id:r}=e==null?void 0:e.row.original;b(r,{message:i("Appending to CSP Settingsâ€¦","urlslab"),status:"info"});const c=await x(`security/add_to_csp_settings/${m}/${r}`,{}),l=await c.json();if(!(c!=null&&c.ok))return b(r,{message:l==null?void 0:l.message,status:"error"}),!1;b(r,{message:l==null?void 0:l.message,status:"success"})},[]),w=n.useMemo(()=>[o.accessor("check",{className:"nolimit checkbox",cell:e=>t.createElement(E,{tableElement:e}),header:e=>t.createElement(E,{tableElement:e})}),o.accessor("violated_directive",{tooltip:e=>e.getValue(),header:e=>t.createElement(p,{...e}),minSize:300}),o.accessor("blocked_url",{className:"nolimit",tooltip:e=>e.getValue(),header:e=>t.createElement(p,{...e}),minSize:300}),o.accessor("updated",{cell:e=>t.createElement(P,{datetime:e.getValue()}),header:e=>t.createElement(p,{...e}),minSize:100}),o.accessor("editRow",{className:"editRow",cell:e=>t.createElement(y,{onDelete:()=>g({cell:e,optionalSelector:T})},t.createElement(B,{size:"xxs",onClick:()=>S(e)},i("Add To CSP Settings","urlslab"))),header:null,size:0})],[S,o,g]);return n.useEffect(()=>{f(s,{data:a})},[a,f,s]),d?t.createElement(D,{isFullscreen:!0}):t.createElement(t.Fragment,null,t.createElement(F,{title:i("About this table","urlslab"),tableSlug:s,isMainTableDescription:!0},i("The table displays a list of CSP (Content Security Policy) violations if you have enabled CSP violation reporting in the settings of this module.","urlslab")),t.createElement(I,{noImport:!0,noInsert:!0}),t.createElement(N,{className:"fadeInto",columns:w,data:u&&v,referrer:C,loadingRows:_,disableAddNewTableRecord:!0},t.createElement(V,null)))}export{H as default};
